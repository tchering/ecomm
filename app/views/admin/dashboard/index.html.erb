<!-- Main Dashboard Container -->
<div class="min-h-screen bg-gray-50">
  <!-- Welcome Section -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Dashboard Overview</h1>
    <p class="mt-1 text-sm text-gray-500">Welcome back! Here's what's happening with your store today.</p>
  </div>
  <!-- Quick Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <!-- Today's Revenue -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Today's Revenue</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= number_to_currency(@today_sales) %></h3>
          <p class="text-xs text-gray-500 mt-1"><%= @today_orders_count %> orders today</p>
        </div>
        <div class="p-2 bg-blue-50 rounded-lg">
          <i class="fas fa-dollar-sign text-blue-500"></i>
        </div>
      </div>
    </div>
    <!-- Weekly Revenue -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Weekly Revenue</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= number_to_currency(@week_sales) %></h3>
          <p class="text-xs text-gray-500 mt-1"><%= @week_orders_count %> orders this week</p>
        </div>
        <div class="p-2 bg-green-50 rounded-lg">
          <i class="fas fa-chart-line text-green-500"></i>
        </div>
      </div>
    </div>
    <!-- Monthly Revenue -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Monthly Revenue</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= number_to_currency(@month_sales) %></h3>
          <p class="text-xs text-gray-500 mt-1"><%= @month_orders_count %> orders this month</p>
        </div>
        <div class="p-2 bg-purple-50 rounded-lg">
          <i class="fas fa-calendar text-purple-500"></i>
        </div>
      </div>
    </div>
    <!-- Average Order Value -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Average Order Value</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= number_to_currency(@average_order_value) %></h3>
          <p class="text-xs text-gray-500 mt-1"><%= @total_orders %> total orders</p>
        </div>
        <div class="p-2 bg-yellow-50 rounded-lg">
          <i class="fas fa-shopping-cart text-yellow-500"></i>
        </div>
      </div>
    </div>
  </div>
  <!-- Additional Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <!-- Total Users -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Users</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= @total_users %></h3>
          <p class="text-xs text-gray-500 mt-1"><%= @new_users_count %> new users this month</p>
        </div>
        <div class="p-2 bg-indigo-50 rounded-lg">
          <i class="fas fa-users text-indigo-500"></i>
        </div>
      </div>
    </div>
    <!-- Total Products -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Products</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= @total_products %></h3>
          <div class="flex space-x-2 text-xs text-gray-500 mt-1">
            <span class="flex items-center">
              <span class="w-2 h-2 rounded-full bg-yellow-500 mr-1"></span>
              <%= @low_stock_count %> low stock
            </span>
            <span class="flex items-center">
              <span class="w-2 h-2 rounded-full bg-red-500 mr-1"></span>
              <%= @out_of_stock_count %> out of stock
            </span>
          </div>
        </div>
        <div class="p-2 bg-red-50 rounded-lg">
          <i class="fab fa-product-hunt text-red-500"></i>
        </div>
      </div>
    </div>
    <!-- Total Revenue -->
    <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Revenue</p>
          <h3 class="text-xl font-bold text-gray-900 mt-1"><%= number_to_currency(@total_sales) %></h3>
          <p class="text-xs text-gray-500 mt-1">Lifetime sales</p>
        </div>
        <div class="p-2 bg-teal-50 rounded-lg">
          <i class="fas fa-money-bill-wave text-teal-500"></i>
        </div>
      </div>
    </div>
  </div>
  <!-- Order Status Section -->
  <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
    <h3 class="text-sm font-semibold text-gray-900 mb-4">Orders by Status</h3>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
      <!-- Pending Orders -->
      <div class="bg-yellow-50 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-yellow-600 mb-1"><%= @pending_orders %></div>
        <p class="text-xs text-gray-600">Pending</p>
      </div>
      <!-- Processing Orders -->
      <div class="bg-blue-50 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-blue-600 mb-1"><%= @processing_orders %></div>
        <p class="text-xs text-gray-600">Processing</p>
      </div>
      <!-- Shipped Orders -->
      <div class="bg-indigo-50 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-indigo-600 mb-1"><%= @shipped_orders %></div>
        <p class="text-xs text-gray-600">Shipped</p>
      </div>
      <!-- Delivered Orders -->
      <div class="bg-green-50 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-green-600 mb-1"><%= @delivered_orders %></div>
        <p class="text-xs text-gray-600">Delivered</p>
      </div>
      <!-- Cancelled Orders -->
      <div class="bg-red-50 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-red-600 mb-1"><%= @cancelled_orders %></div>
        <p class="text-xs text-gray-600">Cancelled</p>
      </div>
    </div>
  </div>
  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
    <!-- Revenue Trend Chart -->
    <div class="bg-white rounded-lg shadow-sm p-4">
      <h3 class="text-sm font-semibold text-gray-900 mb-4">Revenue Trend</h3>
      <div class="h-64">
        <canvas id="revenueTrendChart"></canvas>
      </div>
    </div>
    <!-- Orders Overview Chart -->
    <div class="bg-white rounded-lg shadow-sm p-4">
      <h3 class="text-sm font-semibold text-gray-900 mb-4">Orders Overview</h3>
      <div class="h-64">
        <canvas id="ordersChart"></canvas>
      </div>
    </div>
  </div>
  <!-- Top Products and Low Stock Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <!-- Top Selling Products -->
    <div class="bg-white rounded-lg shadow-sm p-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-sm font-semibold text-gray-900">Top Selling Products</h3>
        <%= link_to "View All Products", admin_products_path, class: "text-xs text-blue-600 hover:text-blue-800" %>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity Sold</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if @top_products.any? %>
              <% @top_products.each do |product| %>
                <tr>
                  <td class="px-4 py-3 whitespace-nowrap">
                    <%= link_to product.title, admin_product_path(product.id), class: "text-sm font-medium text-gray-900 hover:text-blue-600" %>
                  </td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500 text-right">
                    <%= product.total_quantity %>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="2" class="px-4 py-3 text-sm text-gray-500 text-center">No data available</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Low Stock Products -->
    <div class="bg-white rounded-lg shadow-sm p-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-sm font-semibold text-gray-900">Inventory Alerts</h3>
        <%= link_to "Manage Inventory", admin_stocks_path, class: "text-xs text-blue-600 hover:text-blue-800" %>
      </div>
      <!-- Inventory Summary -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-yellow-50 rounded-lg p-3 flex items-center justify-between">
          <div>
            <p class="text-xs text-yellow-800 font-medium">Low Stock Items</p>
            <p class="text-xl font-bold text-yellow-800"><%= @low_stock_count %></p>
          </div>
          <div class="text-yellow-500">
            <i class="fas fa-exclamation-triangle text-2xl"></i>
          </div>
        </div>
        <div class="bg-red-50 rounded-lg p-3 flex items-center justify-between">
          <div>
            <p class="text-xs text-red-800 font-medium">Out of Stock Items</p>
            <p class="text-xl font-bold text-red-800"><%= @out_of_stock_count %></p>
          </div>
          <div class="text-red-500">
            <i class="fas fa-times-circle text-2xl"></i>
          </div>
        </div>
      </div>
      <!-- Tabs for Low Stock and Out of Stock -->
      <div class="border-b border-gray-200 mb-4">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
          <li class="mr-2">
            <a href="#" class="inline-block p-2 border-b-2 border-blue-500 rounded-t-lg text-blue-600 active" 
               id="low-stock-tab" onclick="showTab('low-stock'); return false;">
              Low Stock (<%= @low_stock_count %>)
            </a>
          </li>
          <li class="mr-2">
            <a href="#" class="inline-block p-2 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" 
               id="out-of-stock-tab" onclick="showTab('out-of-stock'); return false;">
              Out of Stock (<%= @out_of_stock_count %>)
            </a>
          </li>
        </ul>
      </div>
      <!-- Low Stock Table -->
      <div id="low-stock-content" class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if @low_stock_products.any? %>
              <% @low_stock_products.each do |product| %>
                <tr>
                  <td class="px-4 py-3 whitespace-nowrap">
                    <%= link_to product.title, admin_product_path(product.id), class: "text-sm font-medium text-gray-900 hover:text-blue-600" %>
                  </td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-right">
                    <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                      <%= product.total_stock %>
                    </span>
                  </td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-right">
                    <%= link_to admin_product_stocks_path(product_id: product.id), class: "px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" do %>
                      <i class="fas fa-plus-circle mr-1"></i> Restock
                    <% end %>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="3" class="px-4 py-3 text-sm text-gray-500 text-center">No low stock products</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <!-- Out of Stock Table -->
      <div id="out-of-stock-content" class="overflow-x-auto hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if @out_of_stock_products.any? %>
              <% @out_of_stock_products.each do |product| %>
                <tr>
                  <td class="px-4 py-3 whitespace-nowrap">
                    <%= link_to product.title, admin_product_path(product.id), class: "text-sm font-medium text-gray-900 hover:text-blue-600" %>
                  </td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-right">
                    <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                      Out of Stock
                    </span>
                  </td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-right">
                    <%= link_to admin_product_stocks_path(product_id: product.id), class: "px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" do %>
                      <i class="fas fa-plus-circle mr-1"></i> Add Stock
                    <% end %>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="3" class="px-4 py-3 text-sm text-gray-500 text-center">No out of stock products</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- Charts JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Revenue Trend Chart
    const revenueTrendCtx = document.getElementById('revenueTrendChart').getContext('2d');
    new Chart(revenueTrendCtx, {
      type: 'line',
      data: {
        labels: <%= raw @daily_sales.map { |day| day[:date].strftime("%b %d") }.to_json %>,
        datasets: [{
          label: 'Revenue',
          data: <%= raw @daily_sales.map { |day| day[:sales] }.to_json %>,
          borderColor: 'rgb(59, 130, 246)',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return '$' + context.raw.toFixed(2);
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value;
              }
            }
          }
        }
      }
    });

    // Orders Chart
    const ordersCtx = document.getElementById('ordersChart').getContext('2d');
    new Chart(ordersCtx, {
      type: 'bar',
      data: {
        labels: <%= raw @daily_sales.map { |day| day[:date].strftime("%b %d") }.to_json %>,
        datasets: [{
          label: 'Orders',
          data: <%= raw @daily_sales.map { |day| day[:orders] }.to_json %>,
          backgroundColor: 'rgba(99, 102, 241, 0.8)',
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1,
              precision: 0
            }
          }
        }
      }
    });
  });

  function showTab(tabName) {
    // Hide all content
    document.getElementById('low-stock-content').classList.add('hidden');
    document.getElementById('out-of-stock-content').classList.add('hidden');

    // Remove active class from all tabs
    document.getElementById('low-stock-tab').classList.remove('border-blue-500', 'text-blue-600');
    document.getElementById('low-stock-tab').classList.add('border-transparent');
    document.getElementById('out-of-stock-tab').classList.remove('border-blue-500', 'text-blue-600');
    document.getElementById('out-of-stock-tab').classList.add('border-transparent');

    // Show selected content and activate tab
    if (tabName === 'low-stock') {
      document.getElementById('low-stock-content').classList.remove('hidden');
      document.getElementById('low-stock-tab').classList.add('border-blue-500', 'text-blue-600');
      document.getElementById('low-stock-tab').classList.remove('border-transparent');
    } else if (tabName === 'out-of-stock') {
      document.getElementById('out-of-stock-content').classList.remove('hidden');
      document.getElementById('out-of-stock-tab').classList.add('border-blue-500', 'text-blue-600');
      document.getElementById('out-of-stock-tab').classList.remove('border-transparent');
    }
  }
</script> 